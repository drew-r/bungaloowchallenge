module.exports = function (req,res,next){
    var _render = res.render;
    res.render = function(data, view){
        var self = this;

        switch(req.accepts('application/json', 'text/html'))
        {
            case 'text/html':
                if (!view) { view = 'default'; if (data.toObject) { data = data.toObject(); } data = { data: data  }; }
                return _render.call(self,view, data);
            case 'application/json': return res.json(data);
            case undefined: return res.send(406);
        }
    };
    next();
};